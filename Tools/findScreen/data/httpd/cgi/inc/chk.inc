<?php
/*=========================================================*/
// ファイル名：chk.inc
//
// NUMERICチェック：NumChk
//
// 作成日：2001/09/18
// 作成者：T.Tamagawa
//
// 解説：入力パラメータのチェックを行う。
//
// 更新履歴
//   ・2007/04/12 Y.Matsukawa 関数追加：chk_knsu_max、chk_rad_max
// 2011/07/05 Y.nakajima	VM化に伴うapache,phpVerUP対応改修
/*=========================================================*/

/*==============================================*/
// NUMERICチェック
/*==============================================*/
  function NumChk($num) {
    $len = strlen($num);
    if ($len != 0) {
      // mod 2011/07/05 Y.Nakajima
      //if ( ereg("[0-9]{" . $len . "}", $num) ) {
      if ( preg_match("/[0-9]{" . $len . "}/", $num) ) {
        $Flg = "OK";
        return $Flg;
      } else {
        /* 文字種不整合 */
        $Flg = "ERR";
        return $Flg;
      }
    } else {
      /* 入力なし */
      $Flg = "NULL";
      return $Flg;
    }
  }

/*==============================================*/
// 半角英数記号＋半角スペースチェック
/*==============================================*/
function chk_sb_anmb($str) {
	$chars = preg_quote("a-zA-Z0-9:;/._!^~'\"@?&=+$,%#()<>{}*")."[:blank:]"."\\-";
	//return ereg("^[".$chars."]+$", $str);

	// mod 2011/07/05 Y.Nakajima [
	//debug
	//パターンエラーバックスラッシュがおかしいといわれる
	//変換後
	//a\-zA\-Z0\-9\:;/\._\!\^~'"@\?&\=\+\$,%#\(\)\<\>\{\}\*[:blank:]\-
	$chars = "a-zA-Z0-9:;\/\._!^~'\"@?&=+$,%#()<>{}*"."[:blank:]";    //."\-";

	$ptn = "/^[".$chars."]/";
	///^[a\-zA\-Z0\-9\:;/\._\!\^~'"@\?&\=\+\$,%#\(\)\<\>\{\}\*[:blank:]\-]/>NG
	// /[^a\-zA\-Z0\-9\:;/\._\!\^~'"@\?&\=\+\$,%#\(\)\<\>\{\}\*[:blank:]\-]/>NG
//debug
//error_log(date("YmdHis").":".__FILE__.":LINE=".__LINE__.":ptn=".$ptn."\n",3,"/home/emap/logs/db_chk.log");
	$ret = preg_match_all($ptn, $str, $matches);
	return $ret;
	// mod 2011/07/05 Y.Nakajima ]
}

/*==============================================*/
// 最寄り検索：指定件数の上限値チェック
/*==============================================*/
function chk_knsu_max($knsu) {
	// １０万件を超える値はエラー
	if ($knsu > 100000) return false;
	return true;
}

/*==============================================*/
// 最寄り検索：半径の上限値チェック
/*==============================================*/
function chk_rad_max($rad) {
	// ５０ｋｍを超える値はエラー
	if ($rad > 50000) return false;
	return true;
}

?>
